(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/write/write"],{1426:function(t,e,n){"use strict";n.r(e);var i=n("1c6c"),a=n("ba39");for(var s in a)"default"!==s&&function(t){n.d(e,t,function(){return a[t]})}(s);var o=n("2877"),r=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,null,null);r.options.__file="write.vue",e["default"]=r.exports},"1c6c":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:"wrap"},[n("view",{staticClass:"write_title"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"请输入标题",eventid:"55bd3010-0"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),n("view",{staticClass:"artList"},t._l(t.artList,function(e,i){return n("block",{key:i},["image"==e.type?n("view",{staticClass:"item"},[n("image",{attrs:{src:e.content,"data-index":i,mode:"widthFix",eventid:"55bd3010-1-"+i},on:{tap:t.removeImg}})]):t._e(),"text"==e.type?n("view",{staticClass:"item"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.artList[i].content,expression:"artList[index].content"}],attrs:{value:e.content,placeholder:"",eventid:"55bd3010-2-"+i},domProps:{value:t.artList[i].content},on:{input:function(e){e.target.composing||(t.artList[i].content=e.target.value)}}}),n("view",{staticClass:"deleteText",attrs:{"data-index":i,eventid:"55bd3010-3-"+i},on:{tap:t.deleteText}},[t._v("删除")])]):t._e()])})),n("form",{attrs:{eventid:"55bd3010-6"},on:{submit:t.submit}},[n("view",{staticClass:"inputArea"},[n("view",{staticClass:"addImg",attrs:{eventid:"55bd3010-4"},on:{tap:t.addImg}},[t._v("+图片")]),n("view",{staticClass:"addText"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputContent,expression:"inputContent"}],attrs:{name:"artText",maxlength:"-1",placeholder:"请输入文本",eventid:"55bd3010-5"},domProps:{value:t.inputContent},on:{input:function(e){e.target.composing||(t.inputContent=e.target.value)}}}),n("button",{attrs:{type:"primary","form-type":"submit"}},[t._v("添加")])],1)])]),n("view",{staticClass:"art-cate"},[n("view",[t._v("文章分类")]),n("view",{},[n("picker",{attrs:{mode:"selector",range:t.caties,eventid:"55bd3010-7"},on:{change:t.cateChange}},[n("view",[t._v(t._s(t.caties[t.currentCateIndex]))])])],1)]),t.artList.length>0?n("view",{staticClass:"submitNow",attrs:{eventid:"55bd3010-8"},on:{tap:t.submitNow}},[t._v("发布文章")]):t._e()],1)},a=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return a})},"2e5f":function(t,e,n){"use strict";(function(t){var i,a;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n("3d82"),o={data:function(){return{title:"",artList:[],inputContent:"",needUploadImg:[],uploadIndex:0,caties:["点击选择"],currentCateIndex:0,catiesFromApi:[],sedCateIndex:0}},onLoad:function(){if(i=this,a=this.checkLogin("../write/write","2"),!a)return!1;s.sign(i.apiServer),t.request({url:this.apiServer+"category&m=index",method:"GET",success:function(t){if("ok"==t.data.status){var e=t.data.data;for(var n in e)i.caties.push(e[n]);i.catiesFromApi=e}}})},onShow:function(){if(a=this.checkLogin("../write/write","2"),!a)return!1;s.sign(i.apiServer)},methods:{cateChange:function(t){var e=t.detail.value;if(this.currentCateIndex=e,!(e<1)){var n=this.caties[e];for(var i in this.catiesFromApi)if(n==this.catiesFromApi[i]){this.sedCateIndex=i;break}this.currentCateIndex=e}},removeImg:function(e){var n=e.currentTarget.dataset.index;t.showModal({content:"确定要删除此图片吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(n,1)}})},deleteText:function(e){var n=e.currentTarget.dataset.index;t.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(n,1)}})},submitNow:function(){if(this.title.length<2)t.showToast({title:"请输入标题",icon:"none"});else if(this.artList.length<1)t.showToast({title:"请填写文章内容",icon:"none"});else if(this.sedCateIndex<1)t.showToast({title:"请选择分类",icon:"none"});else{this.needUploadImg=[];for(var e=0;e<this.artList.length;e++)"image"==this.artList[e].type&&this.needUploadImg.push({tmpurl:this.artList[e].content,indexID:e});console.log(this.needUploadImg),this.uploadImg()}},uploadImg:function(){if(this.needUploadImg.length<1||this.uploadIndex>=this.needUploadImg.length){t.showLoading({title:"正在提交"});var e=t.getStorageSync("sign");t.request({url:this.apiServer+"art&m=add",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{title:i.title,content:JSON.stringify(i.artList),uid:a[0],random:a[1],cate:i.sedCateIndex,sign:e},success:function(e){"ok"==e.data.status?(t.showToast({title:"提交成功",icon:"none"}),i.artList=[],s.sign(i.apiServer),i.currentCateIndex=0,i.sedCateIndex=0,i.needUploadImg=[],i.title="",setTimeout(function(){t.switchTab({url:"../my/my"})},1e3)):t.showToast({title:e.data.data,icon:"none"})}})}else{t.showLoading({title:"上传图片"});t.uploadFile({url:i.apiServer+"uploadimg",filePath:i.needUploadImg[i.uploadIndex].tmpurl,name:"file",success:function(e){if(console.log(e),e=JSON.parse(e.data),"ok"!=e.status)return t.showToast({title:"上传图片失败,请重试!",icon:"none"}),!1;var n=i.needUploadImg[i.uploadIndex].indexID;i.artList[n].content=i.staticServer+e.data,i.uploadIndex++,setTimeout(function(){i.uploadImg()},1e3)},fail:function(e){console.log(e),t.showToast({title:"上传图片失败,请重试!",icon:"none"})}})}},submit:function(e){var n=e.detail.value.artText;n.length<1?t.showToast({title:"请输入内容",icon:"none"}):(this.artList.push({type:"text",content:n}),this.inputContent="")},addImg:function(){t.chooseImage({count:1,sizeType:["compressed"],success:function(t){i.artList.push({type:"image",content:t.tempFilePaths[0]})}})}}};e.default=o}).call(this,n("649d")["default"])},6458:function(t,e,n){"use strict";n("dc25");var i=s(n("b0ce")),a=s(n("1426"));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},ba39:function(t,e,n){"use strict";n.r(e);var i=n("2e5f"),a=n.n(i);for(var s in i)"default"!==s&&function(t){n.d(e,t,function(){return i[t]})}(s);e["default"]=a.a}},[["6458","common/runtime","common/vendor"]]]);